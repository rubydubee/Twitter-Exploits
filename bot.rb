require 'uri'
require 'json'
require 'pp'

class Bot
	
	def initialize(at)
		@access_token = at
	end
	
	def unfollow_traitors
		data = @access_token.get("/account/verify_credentials.json").body
		result = JSON.parse(data)
		username = result['name']
		screen_name = result['screen_name']
		me = screen_name.to_s
		puts me
		
		data = @access_token.get("/1/followers/ids.json?screen_name=#{me}").body
		result1 = JSON.parse(data)
		puts result1.size
		
		data = @access_token.get("/1/friends/ids.json?screen_name=#{me}").body
		result2 = JSON.parse(data)
		puts result2.size
		
		result = result2 - result1
		
		puts result.size
		i = 0
		thread = repeat_every(5) do
			id_to_unfollow = result[i]
			unfollowing = @access_token.post("/friendships/destroy.json?user_id=#{id_to_unfollow}").body
			unfollowed = JSON.parse(unfollowing)
			puts unfollowed["screen_name"]
			i += 1
		end
		
		thread.join
	end
	
	def repeat_every(interval)
	  Thread.new do
		loop do
		  start_time = Time.now
		  yield
		  elapsed = Time.now - start_time
		  sleep([interval - elapsed, 0].max)
		end
	  end
	end


end
